name: PullRequestReviewResult

on:
  pull_request_review:
    types:
      - submitted
jobs:
  get_project_id_job:
    runs-on: ubuntu-latest
    steps:
      - name: Get Project Node ID
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          OWNER: ${{ github.repository_owner }} # オーナー名 (ユーザー名または組織名)
          PROJECT_NUMBER: 5                     # ここを実際のプロジェクト番号に置き換えてください
        run: |
          # オーナーの種類に応じてクエリを切り替えます
          # 組織プロジェクトの場合
          PROJECT_ID=$(gh api graphql -f query='
            query($owner: String!, $number: Int!) {
              organization(login: $owner) {
                projectV2(number: $number) {
                  id
                }
              }
            }' -f owner=$OWNER -F number=$PROJECT_NUMBER --jq '.data.organization.projectV2.id')
          
          # 個人プロジェクトの場合は上記クエリの 'organization' を 'user' に変更します
          if [ -z "$PROJECT_ID" ]; then
             PROJECT_ID=$(gh api graphql -f query='
               query($owner: String!, $number: Int!) {
                 user(login: $owner) {
                   projectV2(number: $number) {
                     id
                   }
                 }
               }' -f owner=$OWNER -F number=$PROJECT_NUMBER --jq '.data.user.projectV2.id')
          fi

          echo "PROJECT_ID=$PROJECT_ID" >> $GITHUB_ENV
          echo "Project Node ID is: $PROJECT_ID"
          
      - name: Use Project ID in subsequent steps
        run: |
          echo "The project ID is now available as an environment variable: ${{ env.PROJECT_ID }}"
          # ここで ${{ env.PROJECT_ID }} を使って他のgh CLIコマンドなどを実行できます
